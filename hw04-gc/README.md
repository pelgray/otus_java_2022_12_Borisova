# Домашняя работа №4

## Определение нужного размера хипа

**Цель:** на примере простого приложения понять какое влияние оказывают сборщики мусора.

**Описание/Пошаговая инструкция выполнения домашнего задания:**

1. Есть готовое приложение `CalcDemo`. Запустите его с размером хипа 256 Мб и посмотрите в логе время выполнения.
   Увеличьте размер хипа до 2 Гб, замерьте время выполнения. Результаты запусков записывайте в таблицу. Определите
   оптимальный размер хипа, т.е. размер, превышение которого, не приводит к сокращению времени выполнения приложения.
2. Оптимизируйте работу приложения. Т.е. не меняя логики работы (но изменяя код), сделайте так, чтобы приложение
   работало быстро с минимальным хипом. Повторите измерения времени выполнения программы для тех же значений размера
   хипа.

## Результаты

### Часть первая

Запуски производились следующим скриптом:

```bash
 #!/bin/sh
 heap=$1
 echo $heap
 java -XX:+UseG1GC -Xms$heap -Xmx$heap -jar hw04-gc-1.0.0.jar
```

Во время этих запусков использовалась одна и та же jar в одинаковых условиях. Результаты запусков представлены в
таблицах.

| Время, мс \ Xmx, Xms Mb |       256 |       267 |       268 |       270 |       300 |       350 |       400 |       450 |       512 |     1 024 |
|:-----------------------:|----------:|----------:|----------:|----------:|----------:|----------:|----------:|----------:|----------:|----------:|
|            1            |    18 020 |    15 664 |    15 823 |    15 460 |    15 094 |    14 026 |    13 742 |    13 056 |    13 007 |    12 079 |
|            2            |           |    15 647 |    15 940 |    15 450 |    14 704 |    14 159 |    13 784 |    13 121 |    13 184 |    12 069 |
|            3            |           |    15 612 |    15 849 |    15 607 |    14 703 |    14 078 |    13 819 |    13 160 |    13 118 |    12 149 |
|            4            |           |           |    16 055 |    15 469 |           |           |           |           |    13 091 |    13 890 |
|            5            |           |           |    15 851 |    15 528 |           |           |           |           |    13 068 |    11 978 |
|            6            |           |           |    16 122 |    15 688 |           |           |           |           |    13 146 |    12 059 |
|            7            |           |           |    15 836 |    15 435 |           |           |           |           |    13 279 |    12 060 |
|            8            |           |           |    15 800 |    15 535 |           |           |           |           |    13 355 |    12 066 |
|            9            |           |           |    15 805 |    15 610 |           |           |           |           |           |           |
|           10            |           |           |    15 859 |    15 538 |           |           |           |           |           |           |
|                         |           |           |           |           |           |           |           |           |           |           |
|    Среднее время, мс    | 18 020,00 | 15 641,00 | 15 894,00 | 15 532,00 | 14 833,67 | 14 087,67 | 13 781,67 | 13 112,33 | 13 156,00 | 12 293,75 |
|       Примечание        |  OOMError |  OOMError |  OOMError |           |           |           |           |           |           |           |

| Время, мс \ Xmx, Xms Mb |     1 536 |     1 680 |     1 681 |     **1 682** |     1 683 |     1 690 |     1 700 |     2 048 |     3 072 |     4 096 |
|:-----------------------:|----------:|----------:|----------:|--------------:|----------:|----------:|----------:|----------:|----------:|----------:|
|            1            |    11 498 |    10 547 |    10 364 |    **10 376** |    10 390 |    10 417 |    10 464 |    11 348 |    11 359 |    11 918 |
|            2            |    11 513 |    10 382 |    10 400 |    **10 371** |    10 389 |    10 418 |    10 479 |    11 346 |    11 579 |    11 984 |
|            3            |    11 481 |    10 547 |    10 386 |    **10 391** |    10 407 |    10 423 |    10 486 |    11 361 |    11 411 |    11 568 |
|            4            |    11 461 |    10 516 |    10 393 |    **10 370** |    10 390 |    10 413 |    10 464 |    11 377 |    11 373 |    11 544 |
|            5            |    11 410 |    10 378 |    10 414 |    **10 385** |    10 424 |    10 420 |    10 468 |    11 363 |    11 591 |    12 448 |
|            6            |    11 540 |           |           |    **10 370** |           |           |           |    11 374 |    11 360 |    11 983 |
|            7            |           |           |           |               |           |           |           |    11 379 |    11 370 |           |
|                         |           |           |           |               |           |           |           |           |           |           |
|    Среднее время, мс    | 11 483,83 | 10 474,00 | 10 391,40 | **10 377,17** | 10 400,00 | 10 418,20 | 10 472,20 | 11 364,00 | 11 434,71 | 11 907,50 |

![img_1.png](img_1.png "График запусков")
Можно сделать вывод, что оптимальный размер хипа для исходного кода, прилагаемого к заданию, является 1682 Мб, т.к.
дальнейшее увеличение доступной памяти не дает прироста в скорости выполнения приложения.
